# Video Storage Guide for CodeLearn Application

## Video Storage Location

Videos are stored in the following folder structure:

```
backend/
├── uploads/
│   ├── videos/          # Video files are stored here
│   └── thumbnails/       # Thumbnail images are stored here
```

## Supported Video Formats

The application supports the following video formats:

### Primary Format (Recommended)
- **MP4** (`.mp4`) - **RECOMMENDED**
  - Best browser compatibility
  - H.264 codec recommended
  - Most widely supported format

### Alternative Formats
- **WebM** (`.webm`)
  - Good for modern browsers
  - VP8/VP9 codec
  - Smaller file sizes

- **OGG** (`.ogg`)
  - Open source format
  - Theora codec
  - Good for Firefox

## Video Specifications (Recommended)

For best performance and compatibility:

### Video Codec
- **H.264** (AVC) - Most compatible
- **VP9** - Better compression, newer browsers
- **VP8** - Good alternative

### Audio Codec
- **AAC** - Best compatibility
- **Vorbis** - For WebM/OGG

### Resolution
- **720p (1280x720)** - Recommended for most courses
- **1080p (1920x1080)** - For high-quality content
- **480p (854x480)** - For smaller file sizes

### Frame Rate
- **30 fps** - Standard
- **24 fps** - For cinematic content
- **60 fps** - For high-motion content

### Bitrate
- **720p**: 2-5 Mbps
- **1080p**: 5-10 Mbps

### File Size Limits
- Maximum file size: **500MB** (configurable in `application.properties`)
- Recommended: Keep videos under 200MB for better streaming

## How to Add Videos

### Option 1: Using the API (Recommended)

Use the upload endpoint to add videos:

```bash
POST /api/videos/upload
Content-Type: multipart/form-data

Parameters:
- file: Video file (MP4, WebM, or OGG)
- title: Video title
- description: Video description
- courseId: Course ID (e.g., "react-pro")
- orderIndex: Order in course (1, 2, 3, ...)
- thumbnail: (Optional) Thumbnail image file
```

**Example using cURL:**
```bash
curl -X POST http://localhost:8080/api/videos/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@/path/to/video.mp4" \
  -F "title=Introduction to React" \
  -F "description=Learn the basics of React" \
  -F "courseId=react-pro" \
  -F "orderIndex=1" \
  -F "thumbnail=@/path/to/thumbnail.jpg"
```

### Option 2: Manual File Placement

1. **Place video file** in `backend/uploads/videos/`
   - Example: `backend/uploads/videos/my-video.mp4`

2. **Create video record** in database:
   ```sql
   INSERT INTO videos (title, description, video_url, thumbnail_url, duration, order_index, course_id)
   VALUES (
       'My Video Title',
       'Video description',
       'my-video.mp4',  -- Filename only, not full path
       'https://example.com/thumbnail.jpg',
       900,  -- Duration in seconds
       1,    -- Order index
       'react-pro'  -- Course ID
   );
   ```

## Video File Naming Convention

- Use **UUID-based filenames** (automatically generated by upload endpoint)
- Format: `{uuid}.mp4` (e.g., `a1b2c3d4-e5f6-7890-abcd-ef1234567890.mp4`)
- This prevents filename conflicts

## Accessing Videos

### Stream Video
```
GET /api/videos/{videoId}/stream
```
Returns the video file for streaming in the browser.

### Get Video Info
```
GET /api/videos/{videoId}
```
Returns video metadata (title, description, URL, etc.).

## Frontend Video Player

The frontend uses the HTML5 `<video>` tag which supports:
- MP4 (H.264)
- WebM
- OGG

Example from `CourseLearnPage.jsx`:
```jsx
<video
  controls
  src={selectedVideo.videoUrl}
>
  Your browser does not support the video tag.
</video>
```

## Configuration

Video storage settings in `application.properties`:

```properties
# File upload settings
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=500MB
spring.servlet.multipart.max-request-size=500MB

# Storage paths
video.storage.path=uploads/videos
thumbnail.storage.path=uploads/thumbnails
```

## Best Practices

1. **Use MP4 format** for maximum compatibility
2. **Compress videos** before uploading to reduce file size
3. **Generate thumbnails** for better user experience
4. **Keep videos under 200MB** for better streaming performance
5. **Use 720p resolution** for most educational content
6. **Include captions/subtitles** for accessibility (store separately)

## Converting Videos to MP4

### Using FFmpeg (Command Line)

```bash
# Convert to MP4 with H.264 codec
ffmpeg -i input.mov -c:v libx264 -c:a aac -b:v 2M -b:a 128k output.mp4

# Resize to 720p
ffmpeg -i input.mp4 -vf scale=1280:720 -c:v libx264 -c:a aac output_720p.mp4

# Extract thumbnail
ffmpeg -i input.mp4 -ss 00:00:05 -vframes 1 thumbnail.jpg
```

### Using HandBrake (GUI)
1. Open HandBrake
2. Select source video
3. Choose "Fast 720p30" preset
4. Set output format to MP4
5. Click "Start Encode"

## Troubleshooting

### Video won't play
- Check video format (must be MP4, WebM, or OGG)
- Verify file is not corrupted
- Check browser console for errors
- Ensure video codec is supported (H.264 recommended)

### Upload fails
- Check file size (must be under 500MB)
- Verify file format is supported
- Check server disk space
- Review application logs for errors

### Video streaming is slow
- Reduce video file size
- Lower resolution (720p instead of 1080p)
- Compress video with lower bitrate
- Consider using a CDN for production

## Production Recommendations

For production environments:

1. **Use Cloud Storage** (AWS S3, Google Cloud Storage, Azure Blob)
2. **Use CDN** for video delivery (CloudFront, Cloudflare)
3. **Implement video transcoding** for multiple formats/resolutions
4. **Add video streaming** (HLS or DASH) for large files
5. **Implement video encryption** for paid content
6. **Add analytics** to track video views and engagement

